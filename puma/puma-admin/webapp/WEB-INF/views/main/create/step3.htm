<style>
#form input {
    margin-left: 16px;
}

#form select {
    margin-left: 16px;
}

#form span.uneditable-input {
    margin-left: 16px;
}
</style>
<div>
   <ul id="stepsBreak" class="breadcrumb">
      <li class="step_done">第1步: 填写基础配置 <span class="divider">&gt;</span></li>
      <li class="step_done">第2步: 创建DumpTask <span class="divider">&gt;</span>
      </li>
      <li class="step_active">第3步: 创建SyncTask</li>
   </ul>
   <a style="float: right; margin-right: 20px;" type="button"
      href="${rc.contextPath}/create/step2" class="btn">上一步</a>
   <p class="legend">创建同步任务</p>
   <div id="saveSyncTaskError" style="margin-top: 20px; display: none;"
      class="alert alert-error">
      <button type="button" class="close" data-dismiss="alert">×</button>
      <p>
         创建失败！详细原因：<span id="saveSyncTaskErrorCause"></span>
      </p>
   </div>
   <div id="saveSyncTaskSuccess"
      style="margin-top: 20px; display: none;"
      class="alert alert-success">
      <button type="button" class="close" data-dismiss="alert">×</button>
      创建任务信息成功！
   </div>
   <h5 style="">请为同步任务，分配一台Puma-SyncServer，如有需要可以修改binlog信息</h5>
   <div
      style="padding: 10px 10px 0px 10px; background-color: white; border: 1px solid rgba(0, 0, 0, 0.15); border-radius: 4px 4px 4px 4px;">
      <form id="form" method="post" onsubmit="createSyncTask(this);return false;"
         action="${rc.contextPath}/create/createSyncTask">
         <div class="container-fluid">
            <div class="row-fluid">
               <div class="span5">
                  #if($dumpTask) 
                    <label>选择源数据库(${srcMysqlConfig.name})的Host:
                    </label> <span class="input-large uneditable-input">$dumpTask.srcMysqlHost.host</span>
                    <label>选择目标数据库(${destMysqlConfig.name})的Host:
                    </label> <span class="input-large uneditable-input">$dumpTask.destMysqlHost.host</span>
                  #else 
                    <label>选择源数据库(${srcMysqlConfig.name})的Host:
                    </label> <select name="srcMysqlHost"
                     style="margin-left: 16px; margin-right: 16px;">
                     #foreach($srcHost in ${srcMysqlConfig.hosts})
                     <option value="$srcHost.host">$srcHost.host</option>
                     #end
                     </select> <label>选择目标数据库(${destMysqlConfig.name})的Host:
                     </label> <select name="destMysqlHost"
                     style="margin-left: 16px; margin-right: 16px;">
                     #foreach($destHost in ${destMysqlConfig.hosts})
                     <option value="$destHost.host">$destHost.host</option>
                     #end
                     </select> 
                  #end 
                  <label>binlog文件：</label><input type="text"
                     name="binlogFile" style="margin-left: 16px;"
                     value="$!{binlogInfo.binlogFile}"><label>
                     binlog位置：</label><input type="text" name="binlogPosition"
                     style="margin-left: 16px;"
                     value="$!{binlogInfo.binlogPosition}"> <label>选择SyncServer服务器作为同步任务的执行者:
                  </label> <select name="syncServerName"
                     style="margin-left: 16px;">
                     #foreach($syncServerConfig in ${syncServerConfigs})
                     <option value="${syncServerConfig.name}">${syncServerConfig.name}</option>
                     #end
                  </select>
               </div>
               <div class="span5">
                  <label>pumaClientName：</label><input type="text"
                     name="pumaClientName" value="${pumaClientName}"
                     style="margin-left: 16px;"> <label>ddl：</label><input
                     type="text" name="ddl" style="margin-left: 16px;"
                     placeholder="可选，默认为true"> <label>dml：</label><input
                     type="text" name="dml" style="margin-left: 16px;"
                     placeholder="可选，默认为true"> <label>transaction：</label><input
                     type="text" name="transaction"
                     style="margin-left: 16px;" placeholder="可选，默认为true">
               </div>
               <button id="createSyncTaskButton"
                  style="float: right; margin-right: 20px;"
                  type="submit" class="btn btn-success">创建任务</button>
            </div>
         </div>
      </form>
   </div>
</div>
<script>
	function createSyncTask(form) {
		$('#saveSyncTaskError').hide();
		$.ajax({
			type : $(form).attr('method'),
			url : $(form).attr('action'),
			data : $(form).serialize(),
			dataType : "json",
			success : createSyncTaskDone,
			error : pumadmin.httpError
		});
		return false;
	}
	function createSyncTaskDone(data) {
		if (data.success == false) {
			//pumadmin.appError("错误信息", data.errorMsg);
			$("#saveSyncTaskErrorCause").text(data.errorMsg);
			$('#saveSyncTaskError').show();
		} else {
			$("#createSyncTaskButton").attr("disabled", "disabled");
			$('#saveSyncTaskSuccess').show();
		}
	}
</script>